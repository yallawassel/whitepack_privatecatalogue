<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>WhitePack â€” Online Catalogue v7.3</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root { --bg:#f5fff8; --accent:#3b7a3a; --accent2:#6ecf6e; --card:#fff; }
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:var(--bg);color:#213}
header{background:linear-gradient(90deg,#a6e8a6,#4ea84e);padding:14px;display:flex;align-items:center;gap:12px}
h1{margin:0;font-size:20px}
.container{padding:16px}
.client-box{background:#fff;border-radius:10px;padding:10px;margin-bottom:12px}
input{width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #ccc}
button{background:#166534;color:#fff;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;margin-top:8px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px}
.card{background:#fff;border-radius:12px;padding:10px;box-shadow:0 2px 6px rgba(0,0,0,0.06);display:flex;flex-direction:column}
.card-img{width:100%;aspect-ratio:1/1;border:1px solid #e2e8f0;border-radius:10px;overflow:hidden}
.card-img img{width:100%;height:100%;object-fit:cover}
.price{font-weight:bold;margin-top:4px}
small{color:#555}
</style>
</head>
<body>
<header>
  <h1>WhitePack</h1>
</header>

<div class="container">
  <div class="client-box">
    <label>Client name</label>
    <input id="clientName" placeholder="Your name">
    <label>Phone number (optional)</label>
    <input id="clientPhone" placeholder="03xxxxxx">
    <button onclick="applyClient()">Load catalogue</button>
  </div>

  <div id="grid" class="grid"></div>
</div>

<script>
const PRODUCTS_URL = "products.json";
const SPECIAL_URL = "special_prices.json";
const RATE = 90000;

let products = [];
let specials = [];
let currentClient = {name:"", phone:""};

function normalizePhone(num){
  if(!num) return "";
  let c = String(num).replace(/\D/g,"");
  if(c.startsWith("961")) return c;
  c = c.replace(/^0+/, "");
  if(c.length <= 8) c = "961" + c;
  return c;
}

async function loadData(){
  products = await (await fetch(PRODUCTS_URL + "?t=" + Date.now())).json();
  try {
    specials = await (await fetch(SPECIAL_URL + "?t=" + Date.now())).json();
  } catch(e){ specials = []; }
  render(products); // public catalogue by default
}
loadData();

function applyClient(){
  currentClient.name = document.getElementById("clientName").value || "Guest";
  currentClient.phone = normalizePhone(document.getElementById("clientPhone").value);

  if(!currentClient.phone){
    render(products);
    return;
  }

  const sp = specials.find(s => normalizePhone(s.phone) === currentClient.phone);
  if(sp){
    const list = products
      .filter(p => sp.products.some(x => x.sku === p.sku))
      .map(p => {
        const s = sp.products.find(x => x.sku === p.sku);
        return {...p, price: s.price};
      });
    render(list);
  } else {
    render(products);
  }
}

function render(list){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  list.forEach(p => {
    grid.innerHTML += `
      <div class="card">
        <div class="card-img">
          <img src="${p.image || ""}" alt="${p.name}" onerror="this.style.display='none'">
        </div>
        <h3>${p.name}</h3>
        <div class="price">${p.price} USD</div>
        <small>${Math.round(p.price * RATE).toLocaleString("en-LB")} LBP</small>
      </div>`;
  });
}
</script>
</body>
</html>
